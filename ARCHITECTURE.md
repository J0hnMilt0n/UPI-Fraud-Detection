# System Architecture - UPI Fraud Detection

## 🏗️ High-Level Architecture

```
┌─────────────────────────────────────────────────────────────────┐
│                         USER INTERFACE                           │
│                    (Next.js + TailwindCSS)                       │
│                                                                   │
│  ┌──────────┐  ┌──────────┐  ┌───────────┐  ┌──────────┐      │
│  │  Landing │  │  Login   │  │ Register  │  │Dashboard │      │
│  │   Page   │  │   Page   │  │   Page    │  │   Page   │      │
│  └──────────┘  └──────────┘  └───────────┘  └──────────┘      │
│                                                                   │
│  ┌────────────────────────────────────────────────────────┐     │
│  │              Authentication Context                     │     │
│  │          (JWT Token Management & User State)            │     │
│  └────────────────────────────────────────────────────────┘     │
│                                                                   │
│  ┌────────────────────────────────────────────────────────┐     │
│  │                 API Client (Axios)                      │     │
│  │         (HTTP Requests + Token Interceptors)            │     │
│  └────────────────────────────────────────────────────────┘     │
└─────────────────────────────────────────────────────────────────┘
                              ▼ HTTP/HTTPS
┌─────────────────────────────────────────────────────────────────┐
│                      BACKEND API LAYER                           │
│                (Django REST Framework + JWT)                     │
│                                                                   │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │   Auth API   │  │ Transaction  │  │   ML Model   │          │
│  │              │  │     API      │  │     API      │          │
│  │ /api/auth/*  │  │/api/trans/*  │  │  /api/ml/*   │          │
│  └──────────────┘  └──────────────┘  └──────────────┘          │
│                                                                   │
│  ┌────────────────────────────────────────────────────────┐     │
│  │              Business Logic Layer                       │     │
│  │                                                          │     │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────────────┐     │     │
│  │  │ accounts │  │transactions│  │   ml_model       │     │     │
│  │  │   app    │  │    app     │  │     app          │     │     │
│  │  └──────────┘  └──────────┘  └──────────────────┘     │     │
│  │                                                          │     │
│  └────────────────────────────────────────────────────────┘     │
│                                                                   │
│  ┌────────────────────────────────────────────────────────┐     │
│  │              Fraud Detection Engine                     │     │
│  │                                                          │     │
│  │  ┌────────────────┐         ┌──────────────────┐       │     │
│  │  │  CNN Model     │   OR    │  Rule-Based      │       │     │
│  │  │  (TensorFlow)  │         │  Detection       │       │     │
│  │  │                │         │  (Fallback)      │       │     │
│  │  └────────────────┘         └──────────────────┘       │     │
│  │                                                          │     │
│  └────────────────────────────────────────────────────────┘     │
│                                                                   │
└─────────────────────────────────────────────────────────────────┘
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                      DATABASE LAYER                              │
│                   (PostgreSQL / SQLite)                          │
│                                                                   │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │    Users     │  │ Transactions │  │ Fraud Alerts │          │
│  │  Profiles    │  │   History    │  │              │          │
│  └──────────────┘  └──────────────┘  └──────────────┘          │
│                                                                   │
└─────────────────────────────────────────────────────────────────┘
```

## 🔄 Data Flow Diagrams

### 1. User Registration Flow

```
User                Frontend              Backend              Database
  │                    │                     │                    │
  ├─ Fill Form ───────>│                     │                    │
  │                    │                     │                    │
  │                    ├─ POST /register ───>│                    │
  │                    │                     │                    │
  │                    │                     ├─ Validate Data     │
  │                    │                     │                    │
  │                    │                     ├─ Hash Password     │
  │                    │                     │                    │
  │                    │                     ├─ Create User ─────>│
  │                    │                     │                    │
  │                    │                     ├─ Create Profile ──>│
  │                    │                     │                    │
  │                    │                     ├─ Generate JWT      │
  │                    │                     │                    │
  │                    │<─── JWT Token ──────┤                    │
  │                    │                     │                    │
  │<─ Redirect Home ───┤                     │                    │
  │                    │                     │                    │
```

### 2. Transaction Creation & Fraud Detection Flow

```
User              Frontend         Backend API        ML Model         Database
  │                  │                  │                │                │
  ├─ Create Txn ────>│                  │                │                │
  │                  │                  │                │                │
  │                  ├─ POST /txn ─────>│                │                │
  │                  │                  │                │                │
  │                  │                  ├─ Validate      │                │
  │                  │                  │                │                │
  │                  │                  ├─ Save Txn ────────────────────>│
  │                  │                  │                │                │
  │                  │                  ├─ Extract ─────>│                │
  │                  │                  │   Features     │                │
  │                  │                  │                │                │
  │                  │                  │                ├─ Reshape       │
  │                  │                  │                │   to 8x8x1     │
  │                  │                  │                │                │
  │                  │                  │                ├─ CNN Predict   │
  │                  │                  │                │                │
  │                  │                  │<─ Fraud Score ─┤                │
  │                  │                  │                │                │
  │                  │                  ├─ Update Txn ──────────────────>│
  │                  │                  │   with result  │                │
  │                  │                  │                │                │
  │                  │                  ├─ Create Alert ────────────────>│
  │                  │                  │   (if fraud)   │                │
  │                  │                  │                │                │
  │                  │<─── Response ────┤                │                │
  │                  │                  │                │                │
  │<─ Show Result ───┤                  │                │                │
  │   + Alert        │                  │                │                │
  │                  │                  │                │                │
```

### 3. Dashboard Statistics Flow

```
User           Frontend         Backend API      Database
  │               │                  │               │
  ├─ View ───────>│                  │               │
  │  Dashboard    │                  │               │
  │               │                  │               │
  │               ├─ GET /stats ────>│               │
  │               │                  │               │
  │               │                  ├─ Query ──────>│
  │               │                  │   User Txns   │
  │               │                  │               │
  │               │                  │<─ Txns Data ──┤
  │               │                  │               │
  │               │                  ├─ Calculate    │
  │               │                  │   Statistics  │
  │               │                  │               │
  │               │                  ├─ Get Alerts ─>│
  │               │                  │               │
  │               │                  │<─ Alerts ─────┤
  │               │                  │               │
  │               │<─── Stats JSON ──┤               │
  │               │                  │               │
  │<─ Render ─────┤                  │               │
  │   Charts &    │                  │               │
  │   Stats       │                  │               │
  │               │                  │               │
```

## 🎯 Component Interaction

```
┌──────────────────────────────────────────────────────────┐
│                     Frontend Layer                        │
├──────────────────────────────────────────────────────────┤
│                                                           │
│  Pages/Components                                         │
│  ┌─────────────┐    ┌──────────────┐   ┌─────────────┐  │
│  │ Dashboard   │───>│ Transaction  │   │  Auth       │  │
│  │ Component   │    │ Form Modal   │   │  Context    │  │
│  └─────────────┘    └──────────────┘   └─────────────┘  │
│         │                   │                   │         │
│         └───────────────────┴───────────────────┘         │
│                             │                             │
│  ┌──────────────────────────┼──────────────────────────┐ │
│  │          Service Layer   │                          │ │
│  │  ┌───────────────────────▼───────────────────────┐ │ │
│  │  │         API Client (Axios)                    │ │ │
│  │  │  - Authentication Interceptor                 │ │ │
│  │  │  - Token Refresh                              │ │ │
│  │  │  - Error Handling                             │ │ │
│  │  └───────────────────────────────────────────────┘ │ │
│  └────────────────────────────────────────────────────┘ │
└────────────────────────┬─────────────────────────────────┘
                         │ HTTP/REST
┌────────────────────────▼─────────────────────────────────┐
│                     Backend Layer                         │
├──────────────────────────────────────────────────────────┤
│                                                           │
│  API Endpoints (Django REST Framework)                    │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐               │
│  │ Auth API │  │ Txn API  │  │  ML API  │               │
│  └────┬─────┘  └────┬─────┘  └────┬─────┘               │
│       │             │              │                      │
│  ┌────▼─────────────▼──────────────▼─────┐               │
│  │          Serializers Layer            │               │
│  │  - Data Validation                    │               │
│  │  - Data Transformation                │               │
│  └────┬──────────────────────────────────┘               │
│       │                                                   │
│  ┌────▼──────────────────────────────────┐               │
│  │         Business Logic                │               │
│  │  ┌──────────┐  ┌──────────────────┐  │               │
│  │  │ Models   │  │ Fraud Detector   │  │               │
│  │  │          │  │   - CNN Model    │  │               │
│  │  │          │  │   - Rules Engine │  │               │
│  │  └──────────┘  └──────────────────┘  │               │
│  └────┬──────────────────────────────────┘               │
│       │                                                   │
│  ┌────▼──────────────────────────────────┐               │
│  │         ORM Layer (Django)            │               │
│  └────┬──────────────────────────────────┘               │
└───────┼──────────────────────────────────────────────────┘
        │
┌───────▼──────────────────────────────────────────────────┐
│                  Database Layer                           │
│                                                            │
│  ┌──────────────┐  ┌──────────────┐  ┌─────────────┐    │
│  │ auth_user    │  │ transactions │  │ fraud_alert │    │
│  │ user_profile │  │              │  │             │    │
│  └──────────────┘  └──────────────┘  └─────────────┘    │
│                                                            │
└────────────────────────────────────────────────────────────┘
```

## 🔐 Security Architecture

```
┌─────────────────────────────────────────────────────────┐
│                    Security Layers                       │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  1. Frontend Security                                    │
│     ┌─────────────────────────────────────────────┐     │
│     │ - Token Storage (localStorage)              │     │
│     │ - Route Protection                          │     │
│     │ - Input Validation                          │     │
│     │ - XSS Prevention                            │     │
│     └─────────────────────────────────────────────┘     │
│                         │                                │
│  2. Transport Security  │                                │
│     ┌───────────────────▼─────────────────────────┐     │
│     │ - HTTPS/TLS Encryption                      │     │
│     │ - CORS Configuration                        │     │
│     │ - JWT Token in Headers                      │     │
│     └─────────────────────────────────────────────┘     │
│                         │                                │
│  3. Backend Security    │                                │
│     ┌───────────────────▼─────────────────────────┐     │
│     │ - JWT Validation                            │     │
│     │ - Permission Checks                         │     │
│     │ - CSRF Protection                           │     │
│     │ - SQL Injection Prevention                  │     │
│     └─────────────────────────────────────────────┘     │
│                         │                                │
│  4. Data Security       │                                │
│     ┌───────────────────▼─────────────────────────┐     │
│     │ - Password Hashing (bcrypt)                 │     │
│     │ - Data Encryption                           │     │
│     │ - Access Control                            │     │
│     │ - Audit Logging                             │     │
│     └─────────────────────────────────────────────┘     │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

## 🚀 Deployment Architecture

```
┌─────────────────────────────────────────────────────────┐
│                  Production Environment                  │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  CDN / Edge Network (Vercel/Netlify)                     │
│  ┌────────────────────────────────────────────────┐     │
│  │          Frontend (Next.js Static)             │     │
│  │  - HTML/CSS/JS                                 │     │
│  │  - Image Optimization                          │     │
│  │  - Caching                                     │     │
│  └───────────────────┬────────────────────────────┘     │
│                      │ API Calls                         │
│  ┌───────────────────▼────────────────────────────┐     │
│  │        Load Balancer (Nginx/Caddy)             │     │
│  └───────────────────┬────────────────────────────┘     │
│                      │                                   │
│  ┌───────────────────▼────────────────────────────┐     │
│  │      Application Servers (Gunicorn)            │     │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐     │     │
│  │  │ Django 1 │  │ Django 2 │  │ Django N │     │     │
│  │  └──────────┘  └──────────┘  └──────────┘     │     │
│  └───────────────────┬────────────────────────────┘     │
│                      │                                   │
│  ┌───────────────────▼────────────────────────────┐     │
│  │         Database (PostgreSQL)                  │     │
│  │  - Master                                      │     │
│  │  - Replicas (Read)                             │     │
│  │  - Backups                                     │     │
│  └────────────────────────────────────────────────┘     │
│                                                          │
│  ┌──────────────────────────────────────────────┐       │
│  │         Cache Layer (Redis)                  │       │
│  │  - Session Storage                           │       │
│  │  - Query Cache                               │       │
│  └──────────────────────────────────────────────┘       │
│                                                          │
│  ┌──────────────────────────────────────────────┐       │
│  │      Monitoring & Logging                    │       │
│  │  - Sentry (Error Tracking)                   │       │
│  │  - CloudWatch/DataDog (Metrics)              │       │
│  │  - ELK Stack (Logs)                          │       │
│  └──────────────────────────────────────────────┘       │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

## 📊 Machine Learning Pipeline

```
┌─────────────────────────────────────────────────────────┐
│              ML Model Training Pipeline                  │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  1. Data Collection                                      │
│     ┌─────────────────────────────────────────────┐     │
│     │ - Historical Transactions                   │     │
│     │ - Labeled Fraud Data                        │     │
│     │ - User Behavior Patterns                    │     │
│     └───────────────────┬─────────────────────────┘     │
│                         │                                │
│  2. Feature Engineering │                                │
│     ┌───────────────────▼─────────────────────────┐     │
│     │ - Amount Normalization                      │     │
│     │ - Time Features                             │     │
│     │ - Pattern Encoding                          │     │
│     │ - Reshape to 8x8x1                          │     │
│     └───────────────────┬─────────────────────────┘     │
│                         │                                │
│  3. Model Training      │                                │
│     ┌───────────────────▼─────────────────────────┐     │
│     │ CNN Architecture                            │     │
│     │  - Conv Layers                              │     │
│     │  - Pooling Layers                           │     │
│     │  - Dense Layers                             │     │
│     │  - Dropout Regularization                   │     │
│     └───────────────────┬─────────────────────────┘     │
│                         │                                │
│  4. Model Evaluation    │                                │
│     ┌───────────────────▼─────────────────────────┐     │
│     │ - Accuracy Metrics                          │     │
│     │ - Precision/Recall                          │     │
│     │ - F1 Score                                  │     │
│     │ - Confusion Matrix                          │     │
│     └───────────────────┬─────────────────────────┘     │
│                         │                                │
│  5. Model Deployment    │                                │
│     ┌───────────────────▼─────────────────────────┐     │
│     │ - Save Model (.h5)                          │     │
│     │ - Save Scaler (.pkl)                        │     │
│     │ - Load in Production                        │     │
│     │ - Real-time Prediction                      │     │
│     └─────────────────────────────────────────────┘     │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

---

**This architecture enables:**

- ✅ Scalability
- ✅ Security
- ✅ Performance
- ✅ Maintainability
- ✅ Real-time Fraud Detection
- ✅ Production-Ready Deployment
